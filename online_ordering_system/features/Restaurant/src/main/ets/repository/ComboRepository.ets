import { Combo } from 'common';
import { Result, ok, err } from '../util/Result';

export interface CombosPage {
  items: Array<Combo>;
  hasMore: boolean;
}

export class ComboRepository {
  // å¯æ›¿æ¢ä¸ºçœŸå®æ¥å£
  async fetchCombos(page: number = 1, pageSize: number = 10): Promise<Result<CombosPage>> {
    try {
      // è¿™é‡Œæš‚ç”¨æœ¬åœ°æ¨¡æ‹Ÿï¼Œåç»­å¯æ›¿æ¢ä¸ºçœŸå®æ¥å£
      const all: Array<Combo> = [
        {
          comboId: '1',
          name: 'ç»å…¸åŒäººå¥—é¤',
          description: 'ç²¾é€‰æ‹›ç‰Œèœ+æ±¤å“+ä¸»é£Ÿï¼Œé€‚åˆä¸¤äººäº«ç”¨',
          icon: 'ğŸ½ï¸',
          image: 'common/images/combo1.png',
          price: 88,
          originalPrice: 120,
          discount: 32,
          dishes: [],
          isAvailable: true,
          tags: ['çƒ­é”€', 'åŒäºº'],
          rating: 4.8,
          reviewCount: 156,
          preparationTime: 25,
          category: 'åŒäººå¥—é¤',
          sortOrder: 1
        },
        {
          comboId: '2',
          name: 'å®¶åº­å››äººå¥—é¤',
          description: 'ä¸°å¯Œèœå“ç»„åˆï¼Œæ»¡è¶³å…¨å®¶å£å‘³éœ€æ±‚',
          icon: 'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦',
          image: 'common/images/combo2.png',
          price: 168,
          originalPrice: 220,
          discount: 52,
          dishes: [],
          isAvailable: true,
          tags: ['å®¶åº­', 'å®æƒ '],
          rating: 4.6,
          reviewCount: 89,
          preparationTime: 30,
          category: 'å®¶åº­å¥—é¤',
          sortOrder: 2
        },
        {
          comboId: '3',
          name: 'å•†åŠ¡å¥—é¤',
          description: 'ç²¾è‡´èœå“æ­é…ï¼Œé€‚åˆå•†åŠ¡å®´è¯·',
          icon: 'ğŸ’¼',
          image: 'common/images/combo3.png',
          price: 288,
          originalPrice: 350,
          discount: 62,
          dishes: [],
          isAvailable: true,
          tags: ['å•†åŠ¡', 'ç²¾è‡´'],
          rating: 4.9,
          reviewCount: 45,
          preparationTime: 35,
          category: 'å•†åŠ¡å¥—é¤',
          sortOrder: 3
        },
        {
          comboId: '4',
          name: 'æƒ…ä¾£æµªæ¼«å¥—é¤',
          description: 'æµªæ¼«æ°›å›´èœå“ï¼Œé€‚åˆæƒ…ä¾£çº¦ä¼š',
          icon: 'ğŸ’•',
          image: 'common/images/combo4.png',
          price: 128,
          originalPrice: 160,
          discount: 32,
          dishes: [],
          isAvailable: true,
          tags: ['æµªæ¼«', 'æƒ…ä¾£'],
          rating: 4.7,
          reviewCount: 78,
          preparationTime: 20,
          category: 'æƒ…ä¾£å¥—é¤',
          sortOrder: 4
        },
        {
          comboId: '5',
          name: 'å„¿ç«¥å¥—é¤',
          description: 'è¥å…»å‡è¡¡ï¼Œé€‚åˆå°æœ‹å‹',
          icon: 'ğŸ‘¶',
          image: 'common/images/combo5.png',
          price: 58,
          originalPrice: 78,
          discount: 20,
          dishes: [],
          isAvailable: true,
          tags: ['å„¿ç«¥', 'è¥å…»'],
          rating: 4.5,
          reviewCount: 32,
          preparationTime: 15,
          category: 'å„¿ç«¥å¥—é¤',
          sortOrder: 5
        },
        {
          comboId: '6',
          name: 'ç´ é£Ÿå¥—é¤',
          description: 'å…¨ç´ èœå“ï¼Œå¥åº·è¥å…»',
          icon: 'ğŸ¥—',
          image: 'common/images/combo6.png',
          price: 98,
          originalPrice: 128,
          discount: 30,
          dishes: [],
          isAvailable: true,
          tags: ['ç´ é£Ÿ', 'å¥åº·'],
          rating: 4.4,
          reviewCount: 67,
          preparationTime: 18,
          category: 'ç´ é£Ÿå¥—é¤',
          sortOrder: 6
        }
      ];
      
      const start = (page - 1) * pageSize;
      const end = start + pageSize;
      const items: Array<Combo> = all.slice(start, end);
      const hasMore: boolean = end < all.length;
      const pageData: CombosPage = { items: items, hasMore: hasMore };
      return ok<CombosPage>(pageData);
    } catch (e) {
      return err('åŠ è½½å¥—é¤å¤±è´¥');
    }
  }

  // æ ¹æ®åˆ†ç±»è·å–å¥—é¤
  async fetchCombosByCategory(category: string, page: number = 1, pageSize: number = 10): Promise<Result<CombosPage>> {
    try {
      const result = await this.fetchCombos(1, 100); // è·å–æ‰€æœ‰å¥—é¤
      if (result.ok) {
        const filteredItems = result.data.items.filter(combo => combo.category === category);
        const start = (page - 1) * pageSize;
        const end = start + pageSize;
        const items = filteredItems.slice(start, end);
        const hasMore = end < filteredItems.length;
        const pageData: CombosPage = { items, hasMore };
        return ok<CombosPage>(pageData);
      }
      return result;
    } catch (e) {
      return err('æŒ‰åˆ†ç±»åŠ è½½å¥—é¤å¤±è´¥');
    }
  }

  // æ ¹æ®IDè·å–å¥—é¤è¯¦æƒ…
  async fetchComboById(comboId: string): Promise<Result<Combo>> {
    try {
      const result = await this.fetchCombos(1, 100); // è·å–æ‰€æœ‰å¥—é¤
      if (result.ok) {
        const combo = result.data.items.find(c => c.comboId === comboId);
        if (combo) {
          return ok<Combo>(combo);
        }
        return err('å¥—é¤ä¸å­˜åœ¨');
      }
      return err('åŠ è½½å¥—é¤è¯¦æƒ…å¤±è´¥');
    } catch (e) {
      return err('åŠ è½½å¥—é¤è¯¦æƒ…å¤±è´¥');
    }
  }
}
